//const fs = require('fs');
const axios = require('axios');

const API_KEY = "23db7c3f79974942ab2234108252803";

async function forecastJson() {
    const userPosNot = prompt("Enter Location: ");
    const userPos = userPosNot.charAt(0).toUpperCase() + userPosNot.slice(1);
    const aqiChoice = prompt("Would you like air quality alerts? (yes/no): ");
    const alertChoice = prompt("Would you like weather alerts? (yes/no): ");
    const dayAmount = prompt("Number of days to forecast (1-14): ");
    const urlNoArgs = `http://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${userPos}&days=${dayAmount}&aqi=${aqiChoice}&alerts=${alertChoice}`;

    try {
        console.log("Getting data from: ", urlNoArgs);
        const response = await axios.get(urlNoArgs);
        console.log("Status Code: ", response.status);
        console.log(response.data);

        const copy = prompt("Would you like to log the data? \n (y/n)?: ").toLowerCase();
        if (copy === "y") {
            fs.appendFileSync('log.txt', JSON.stringify(response.data, null, 2));
            console.log("Copied");
            console.log("Hit CTRL-C to exit program (if run in terminal)");
        } else {
            console.log("Ok!, Hit CTRL-C to exit program (if run in terminal)");
        }
    } catch (error) {
        console.error("Error fetching data:", error.message);
    }
}

async function currentJson() {
    const userPosNot = prompt("Enter Location: ");
    const userPos = userPosNot.charAt(0).toUpperCase() + userPosNot.slice(1);
    const aqiChoice = prompt("Would you like air quality alerts? (y/n): ");
    const urlNoArgs = `http://api.weatherapi.com/v1/current.json?key=${API_KEY}&q=${userPos}&aqi=${aqiChoice}`;

    try {
        console.log("Getting data from: ", urlNoArgs);
        const response = await axios.get(urlNoArgs);
        console.log("Status Code: ", response.status);
        console.log(response.data);

        const copy = prompt("Would you like to copy the data? \n (y/n)?: ").toLowerCase();
        if (copy === "y") {
            fs.appendFileSync('log.txt', JSON.stringify(response.data, null, 2));
            console.log("Copied");
            console.log("Hit CTRL-C to exit program (if run in terminal)");
        } else {
            console.log("Ok!, Hit CTRL-C to exit program (if run in terminal)");
        }
    } catch (error) {
        console.error("Error fetching data:", error.message);
    }
}

async function alertsJson() {
    const userPosNot = prompt("Enter Location: ");
    const userPos = userPosNot.charAt(0).toUpperCase() + userPosNot.slice(1);
    const urlNoArgs = `http://api.weatherapi.com/v1/alerts.json?key=${API_KEY}&q=${userPos}`;

    try {
        console.log("Getting data from: ", urlNoArgs);
        const response = await axios.get(urlNoArgs);
        console.log("Status Code: ", response.status);
        console.log(response.data);

        const copy = prompt("Would you like to copy the data? \n (y/n)?: ").toLowerCase();
        if (copy === "y") {
            fs.appendFileSync('log.txt', JSON.stringify(response.data, null, 2));
            console.log("Copied");
            console.log("Hit CTRL-C to exit program (if run in terminal)");
        } else {
            console.log("Ok!, Hit CTRL-C to exit program (if run in terminal)");
        }
    } catch (error) {
        console.error("Error fetching data:", error.message);
    }
}

async function astronomyJson() {
    const userPosNot = prompt("Enter Location: ");
    const userPos = userPosNot.charAt(0).toUpperCase() + userPosNot.slice(1);
    const dt = prompt("Enter date (yyyy-MM-dd): ");
    const urlNoArgs = `http://api.weatherapi.com/v1/astronomy.json?key=${API_KEY}&q=${userPos}&dt=${dt}`;

    try {
        console.log("Getting data from: ", urlNoArgs);
        const response = await axios.get(urlNoArgs);
        console.log("Status Code: ", response.status);
        console.log(response.data);

        const copy = prompt("Would you like to copy the data? \n (y/n)?: ").toLowerCase();
        if (copy === "y") {
            fs.appendFileSync('log.txt', JSON.stringify(response.data, null, 2));
            console.log("Copied");
            console.log("Hit CTRL-C to exit program (if run in terminal)");
        } else {
            console.log("Ok!, Hit CTRL-C to exit program (if run in terminal)");
        }
    } catch (error) {
        console.error("Error fetching data:", error.message);
    }
}

console.log("Enter Data to pull:");
console.log("Current Forecast, CF");
console.log("Forecast, F");
console.log("Alerts, A");
console.log("Astronomy, AS");
console.log("Clear Log File, Clear");

const userChoice = prompt("Enter Data to pull: ");
console.log(`Pulling Data, '${userChoice}'.`);

switch (userChoice) {
    case "CF":
        currentJson();
        break;
    case "F":
        forecastJson();
        break;
    case "A":
        alertsJson();
        break;
    case "AS":
        astronomyJson();
        break;
    case "Clear":
        fs.writeFileSync('log.txt', "//");
        console.log("Log file cleared.");
        break;
    default:
        console.log("Invalid choice!");
}